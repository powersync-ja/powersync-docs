---
title: "Usage Examples"
description: "Code snippets and guidelines for common scenarios in Swift"
---

## Using transactions to group changes

Read and write transactions present a context where multiple changes can be made then finally committed to the DB or rolled back. This ensures that either all the changes get persisted, or no change is made to the DB (in the case of a rollback or exception).

```swift
// Delete a list and its todos in a transaction
//TODO: review
func deleteList(db: PowerSyncDatabase, listId: String) async throws {
    try await db.writeTransaction { tx in
        try await tx.execute(sql: "DELETE FROM lists WHERE id = ?", parameters: [listId])
        try await tx.execute(sql: "DELETE FROM todos WHERE list_id = ?", parameters: [listId])
    }
}
```

Also see [`readTransaction`](https://powersync-ja.github.io/powersync-swift/documentation/powersync/queries/readtransaction(callback:)).

## Subscribe to changes in data

Use `watch` to watch for changes to the dependent tables of any SQL query.

```swift
// Watch for changes to the lists table
func watchLists(_ callback: @escaping (_ lists: [ListContent]) -> Void ) async {
    do {
        for try await lists in try self.db.watch<ListContent>(
            sql: "SELECT * FROM \(LISTS_TABLE)",
            parameters: [],
            mapper: { cursor in
                try ListContent(
                    id: cursor.getString(name: "id"),
                    name: cursor.getString(name: "name"),
                    createdAt: cursor.getString(name: "created_at"),
                    ownerId: cursor.getString(name: "owner_id")
                )
            }
        ) {
            callback(lists)
        }
    } catch {
        print("Error in watch: \(error)")
    }
}
```

## Insert, update, and delete data in the local database

Use `execute` to run INSERT, UPDATE or DELETE queries.

```swift
// Insert a new TODO
func insertTodo(_ todo: NewTodo, _ listId: String) async throws {
    try await db.execute(
        sql: "INSERT INTO \(TODOS_TABLE) (id, created_at, created_by, description, list_id, completed) VALUES (uuid(), datetime(), ?, ?, ?, ?)",
        parameters: [connector.currentUserID, todo.description, listId, todo.isComplete]
    )
}
```

## Send changes in local data to your backend service

Override `uploadData` to send local updates to your backend service.

```swift
//TODO - review
class MyConnector: PowerSyncBackendConnector {
    override func uploadData(database: PowerSyncDatabaseProtocol) async throws {
        let batch = try await database.getCrudBatch()
        guard let batch = batch else { return }
        for entry in batch.crud {
            switch entry.op {
            case .put:
                // Send the data to your backend service
                // Replace `_myApi` with your own API client or service
                try await _myApi.put(table: entry.table, data: entry.opData)
            default:
                // TODO: implement the other operations (patch, delete)
                break
            }
        }
        try await batch.complete()
    }
}
```

## Accessing PowerSync connection status information

Use [`currentStatus`](https://powersync-ja.github.io/powersync-swift/documentation/powersync/powersyncdatabaseprotocol/currentstatus) and observe changes to listen for status changes to your PowerSync instance.

```swift
//TODO
```

## Wait for the initial sync to complete

Use the `hasSynced` property and observe status changes to indicate to the user whether the initial sync is in progress.

```swift
//TODO
```

For async use cases, use [`waitForFirstSync`](https://powersync-ja.github.io/powersync-swift/documentation/powersync/powersyncdatabaseprotocol/waitforfirstsync()).

## Report sync download progress

You can show users a progress bar when data downloads using the `downloadProgress` property from the [`SyncStatusData`](https://powersync-ja.github.io/powersync-swift/documentation/powersync/syncstatusdata/) object. `downloadProgress.fraction` gives you a value from 0.0 to 1.0 representing the total sync progress. This is especially useful for long-running initial syncs.

Example:

```swift
//TODO
```

Also see:
- [SyncStatusData API](https://powersync-ja.github.io/powersync-swift/documentation/powersync/syncstatusdata/)
- [SyncDownloadProgress API](https://powersync-ja.github.io/powersync-swift/documentation/powersync/syncdownloadprogress/)
- [Demo component](https://github.com/powersync-ja/powersync-swift/blob/main/Demo/PowerSyncExample/Components/ListView.swift)

